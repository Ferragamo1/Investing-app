<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ferragamo Weekly Investing Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- PWA meta for iPhone -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Ferragamo Plan">

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS icons (optional but recommended if you add real icon files) -->
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      background: #020617;
      color: #f9fafb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 12px 8px 24px;
    }

    .app {
      width: 100%;
      max-width: 420px;
      background: rgba(15, 23, 42, 0.97);
      border-radius: 20px;
      padding: 16px 16px 20px;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .header {
      margin-bottom: 10px;
    }

    .title {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .subtitle {
      font-size: 0.78rem;
      color: #9ca3af;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 0.7rem;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #e5e7eb;
      margin-top: 7px;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
    }

    .card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 16px;
      padding: 12px 12px 14px;
      margin-top: 10px;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .week-label {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .year-label {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .chip {
      font-size: 0.7rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(37, 99, 235, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.7);
      color: #dbeafe;
      white-space: nowrap;
    }

    .list {
      list-style: none;
      margin-top: 4px;
    }

    .list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      font-size: 0.83rem;
    }

    .ticker {
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .amount {
      font-weight: 600;
      color: #bbf7d0;
      font-size: 0.86rem;
    }

    .section-title {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin-top: 10px;
      margin-bottom: 4px;
    }

    .meta-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.72rem;
      color: #9ca3af;
      margin-top: 4px;
      gap: 4px;
    }

    .meta-row span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: #fbbf24;
      flex-shrink: 0;
    }

    .controls {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px solid rgba(148, 163, 184, 0.25);
    }

    .controls label {
      font-size: 0.78rem;
      color: #9ca3af;
      display: block;
      margin-bottom: 4px;
    }

    .controls-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .controls input[type="date"] {
      flex: 1;
      background: #020617;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 6px 8px;
      color: #e5e7eb;
      font-size: 0.78rem;
    }

    .controls input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(0.8);
    }

    .controls button {
      border: none;
      border-radius: 10px;
      padding: 7px 10px;
      font-size: 0.76rem;
      font-weight: 600;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      cursor: pointer;
      white-space: nowrap;
    }

    .controls button:active {
      transform: translateY(1px);
      opacity: 0.92;
    }

    .hint {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 4px;
    }

    .warning {
      font-size: 0.74rem;
      color: #f97316;
      margin-top: 6px;
    }

    @media (max-width: 390px) {
      .app {
        border-radius: 0;
        border-width: 0;
        box-shadow: none;
        padding: 12px 10px 18px;
      }

      .title {
        font-size: 0.98rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title">Ferragamo Weekly Investing Plan</div>
      <div class="subtitle">$20 per week â€¢ VOO + NVDA + rotating pick</div>
      <div class="pill">
        <span class="pill-dot"></span>
        Auto syncs with current week of the year
      </div>
    </div>

    <div class="card" id="plan-card">
      <div class="card-header">
        <div>
          <div class="week-label" id="week-label">Week ?</div>
          <div class="year-label" id="year-label">Year ?</div>
        </div>
        <div class="chip" id="status-chip">Loading...</div>
      </div>

      <div id="plan-content">
        <!-- Filled by JS -->
      </div>
    </div>

    <div class="controls">
      <label for="date-input">Check another date</label>
      <div class="controls-row">
        <input type="date" id="date-input" />
        <button id="go-btn">View</button>
      </div>
      <div class="hint">
        Default view uses today. Pick any date to see what that week should invest.
      </div>
      <div class="warning">
        Plan starts in <strong>Week 50 of 2025</strong>. Before that there is no rotation pick.
      </div>
    </div>

    <div class="section-title">Base plan (every week)</div>
    <ul class="list">
      <li><span class="ticker">VOO</span><span class="amount">$12</span></li>
      <li><span class="ticker">NVDA</span><span class="amount">$5</span></li>
    </ul>
    <div class="meta-row">
      <span><span class="dot"></span><span>Rotating pick uses the $3 slot</span></span>
      <span>Total weekly: <strong>$20</strong></span>
    </div>
  </div>

  <script>
    // ISO week helper
    function getISOWeek(date) {
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      const weekNo = Math.ceil(((d - yearStart) / 86400000 + 1) / 7);
      return { week: weekNo, year: d.getUTCFullYear() };
    }

    // Rotation logic
    function getRotatingPick(week, year) {
      if (year < 2025) {
        return { ticker: null, message: "Plan not started yet", active: false };
      }

      // December 2025 start
      if (year === 2025) {
        if (week < 50) {
          return { ticker: null, message: "Plan starts in Week 50 of 2025", active: false };
        }
        if (week === 50) return { ticker: "NVDA", message: "December 2025 ramp up", active: true };
        if (week === 51) return { ticker: "PLTR", message: "December 2025 rotation", active: true };
        if (week === 52) return { ticker: "ARM", message: "December 2025 chip hype", active: true };
      }

      // Full year 2026 mapping
      if (year === 2026) {
        if (week >= 1 && week <= 4) return { ticker: "PLTR", message: "January: PLTR block", active: true };
        if (week >= 5 && week <= 8) return { ticker: "NVDA", message: "February: extra NVDA stack", active: true };
        if (week >= 9 && week <= 13) return { ticker: "ARM", message: "March: ARM rotation", active: true };
        if (week >= 14 && week <= 17) return { ticker: "SMCI", message: "April: SMCI servers", active: true };
        if (week >= 18 && week <= 21) return { ticker: "PLTR", message: "May: PLTR again", active: true };
        if (week >= 22 && week <= 26) return { ticker: "TSLA", message: "June: TSLA volatility", active: true };
        if (week >= 27 && week <= 30) return { ticker: "NVDA", message: "July: NVDA block", active: true };
        if (week >= 31 && week <= 35) return { ticker: "ARM", message: "August: ARM block", active: true };
        if (week >= 36 && week <= 39) return { ticker: "SMCI", message: "September: SMCI block", active: true };
        if (week >= 40 && week <= 43) return { ticker: "PLTR", message: "October: PLTR block", active: true };
        if (week >= 44 && week <= 48) return { ticker: "NVDA", message: "November: NVDA block", active: true };
        if (week >= 49 && week <= 52) return { ticker: "TSLA", message: "December: TSLA block", active: true };
        return { ticker: null, message: "Week out of range for 2026", active: false };
      }

      if (year > 2026) {
        return { ticker: null, message: "Plan currently defined through the end of 2026", active: false };
      }

      return { ticker: null, message: "No rotation defined for this week", active: false };
    }

    function renderPlan(date) {
      const { week, year } = getISOWeek(date);
      const weekLabel = document.getElementById("week-label");
      const yearLabel = document.getElementById("year-label");
      const chip = document.getElementById("status-chip");
      const planContent = document.getElementById("plan-content");

      weekLabel.textContent = `Week ${week}`;
      yearLabel.textContent = `Year ${year}`;

      const rotation = getRotatingPick(week, year);
      planContent.innerHTML = "";

      if (!rotation.active) {
        chip.textContent = "Rotation inactive";
        chip.style.background = "rgba(239,68,68,0.14)";
        chip.style.borderColor = "rgba(248,113,113,0.9)";
        chip.style.color = "#fecaca";

        const p = document.createElement("p");
        p.style.fontSize = "0.8rem";
        p.style.color = "#e5e7eb";
        p.style.marginTop = "2px";
        p.textContent = rotation.message;
        planContent.appendChild(p);
        return;
      }

      chip.textContent = `${rotation.ticker} week`;
      chip.style.background = "rgba(34,197,94,0.18)";
      chip.style.borderColor = "rgba(34,197,94,0.9)";
      chip.style.color = "#bbf7d0";

      const list = document.createElement("ul");
      list.className = "list";

      const items = [
        { ticker: "VOO", amount: "$12" },
        { ticker: "NVDA", amount: "$5" },
        { ticker: rotation.ticker, amount: "$3" }
      ];

      items.forEach(item => {
        const li = document.createElement("li");
        const left = document.createElement("span");
        left.className = "ticker";
        left.textContent = item.ticker;
        const right = document.createElement("span");
        right.className = "amount";
        right.textContent = item.amount;
        li.appendChild(left);
        li.appendChild(right);
        list.appendChild(li);
      });

      planContent.appendChild(list);

      const meta = document.createElement("div");
      meta.className = "meta-row";
      meta.style.marginTop = "6px";

      const spanLeft = document.createElement("span");
      const dot = document.createElement("span");
      dot.className = "dot";
      spanLeft.appendChild(dot);
      const text = document.createElement("span");
      text.textContent = `This week uses the $3 slot for ${rotation.ticker}`;
      text.style.fontSize = "0.72rem";
      text.style.color = "#9ca3af";
      spanLeft.appendChild(text);

      const spanRight = document.createElement("span");
      spanRight.textContent = "Total: $20";
      spanRight.style.fontSize = "0.76rem";
      spanRight.style.fontWeight = "600";
      spanRight.style.color = "#e5e7eb";

      meta.appendChild(spanLeft);
      meta.appendChild(spanRight);
      planContent.appendChild(meta);

      const msg = document.createElement("p");
      msg.style.fontSize = "0.74rem";
      msg.style.color = "#9ca3af";
      msg.style.marginTop = "4px";
      msg.textContent = rotation.message;
      planContent.appendChild(msg);
    }

    document.addEventListener("DOMContentLoaded", () => {
      const today = new Date();
      renderPlan(today);

      const dateInput = document.getElementById("date-input");
      const goBtn = document.getElementById("go-btn");

      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      dateInput.value = `${yyyy}-${mm}-${dd}`;

      goBtn.addEventListener("click", () => {
        if (!dateInput.value) return;
        const [y, m, d] = dateInput.value.split("-").map(Number);
        const selected = new Date(y, m - 1, d);
        renderPlan(selected);
      });

      // Register service worker for PWA
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("service-worker.js")
          .catch(err => console.error("SW registration failed", err));
      }
    });
  </script>
</body>
</html>
